pool:
  vmImage: 'macOS-10.14'

# also sets the name of the package
name: 0.1$(rev:.r)

variables:
  buildConfiguration: 'Release'
  libraryName: 'Konoma.CrossFit'

steps:

- task: DotNetCoreCLI@2
  inputs:
    command: restore

- script: msbuild $(libraryName)/$(libraryName).csproj /property:Configuration=$(buildConfiguration)
  displayName: 'Build umbrella'

- script: msbuild $(libraryName)/$(libraryName).Droid.csproj /property:Configuration=$(buildConfiguration)
  displayName: 'Build iOS'

- script: msbuild $(libraryName)/$(libraryName).iOS.csproj /property:Configuration=$(buildConfiguration)
  displayName: 'Build Android'

- task: NuGetCommand@2
  displayName: 'Pack NuGet package'
  inputs:
    command: pack
    configuration: $(buildConfiguration)
    packagesToPack: $(libraryName).nuspec
    versioningScheme: byBuildNumber
  condition: succeeded()

- task: NuGetCommand@2
  displayName: 'Publish NuGet package'
  inputs:
    command: push
    publishVstsFeed: 'Libraries'
    allowPackageConflicts: true
  condition: succeeded()
